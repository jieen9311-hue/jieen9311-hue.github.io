<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>F1 è³‡è¨Šç«™ â€” å–®æª” HTML ç¯„ä¾‹</title>
  <!-- Tailwind Play CDN for quick demo -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small utilities */
    .glass { background: rgba(255,255,255,0.06); backdrop-filter: blur(6px); }
  </style>
</head>
<body class="antialiased bg-gray-50 text-gray-900">
  <div id="app" class="min-h-screen max-w-6xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-full bg-red-600 text-white flex items-center justify-center font-bold">F1</div>
        <div>
          <h1 class="text-2xl font-extrabold">F1 è³‡è¨Šç«™</h1>
          <p class="text-sm text-gray-500">è³½ç¨‹ã€è»Šæ‰‹ã€ç©åˆ†èˆ‡å³æ™‚æ–°è</p>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <select id="season" class="px-3 py-1 rounded bg-white/80">
          <option value="current">ä»Šå¹´è³½å­£</option>
          <option value="2024">2024</option>
          <option value="2023">2023</option>
        </select>
        <button id="themeToggle" class="px-3 py-1 rounded glass">æ·±è‰²</button>
      </div>
    </header>

    <!-- Nav -->
    <nav class="flex gap-6 mb-6 text-lg">
      <a href="#/" class="nav-link">ğŸ  é¦–é </a>
      <a href="#/races" class="nav-link">ğŸ“… è³½ç¨‹</a>
      <a href="#/drivers" class="nav-link">ğŸ‘¨â€ğŸš€ è»Šæ‰‹</a>
    </nav>

    <!-- App container -->
    <main id="view"></main>

    <footer class="mt-10 text-sm text-gray-500 border-t pt-4">Â© <span id="year"></span> F1 è³‡è¨Šç«™ â€¢ è³‡æ–™ä¾†æºï¼šErgast APIï¼ˆç¯„ä¾‹ï¼‰</footer>
  </div>

  <script>
    // -----------------------------
    // Simple hash router
    // -----------------------------
    const routes = {
      '/': renderHome,
      '/races': renderRaces,
      '/drivers': renderDrivers,
    };

    function router() {
      const path = location.hash.replace('#','') || '/';
      const view = routes[path] || routes['/'];
      view();
      document.querySelectorAll('.nav-link').forEach(a => a.classList.remove('font-bold'));
      document.querySelectorAll('.nav-link').forEach(a => {
        if (a.getAttribute('href') === '#' + path) a.classList.add('font-bold');
      });
    }

    window.addEventListener('hashchange', router);
    window.addEventListener('load', () => { document.getElementById('year').textContent = new Date().getFullYear(); router(); fetchSeasonData(); });

    // -----------------------------
    // State & Data Fetching
    // -----------------------------
    let state = {
      season: 'current',
      races: [],
      standings: [],
      drivers: [],
    };

    document.getElementById('season').addEventListener('change', (e) => { state.season = e.target.value; fetchSeasonData(); });

    async function fetchSeasonData() {
      const s = state.season === 'current' ? new Date().getFullYear() : state.season;
      try {
        // races
        const r = await fetch(`https://ergast.com/api/f1/${s}.json`).then(res => res.json());
        state.races = r.MRData?.RaceTable?.Races || [];

        // driver standings
        const st = await fetch(`https://ergast.com/api/f1/${s}/driverStandings.json`).then(res => res.json());
        state.standings = st.MRData?.StandingsTable?.StandingsLists?.[0]?.DriverStandings || [];

        // drivers list (from standings)
        state.drivers = state.standings.map(d => ({ id: d.Driver.driverId, name: d.Driver.givenName + ' ' + d.Driver.familyName, team: d.Constructors?.[0]?.name || '' }));

        // re-render current view if needed
        router();
      } catch (err) {
        console.error('fetch error', err);
      }
    }

    // -----------------------------
    // Utilities
    // -----------------------------
    function el(html) { const div = document.createElement('div'); div.innerHTML = html; return div.firstElementChild; }

    function formatDateISO(iso) {
      try {
        const d = new Date(iso);
        return d.toLocaleString();
      } catch { return iso; }
    }

    // Countdown component (returns element)
    function Countdown(targetISO) {
      const container = document.createElement('div');
      container.className = 'text-xl font-semibold';

      function tick() {
        const diff = new Date(targetISO) - new Date();
        if (isNaN(diff)) { container.textContent = 'æ™‚é–“æ ¼å¼éŒ¯èª¤'; return; }
        if (diff <= 0) { container.textContent = 'ğŸ æ¯”è³½é–‹å§‹ï¼'; clearInterval(timer); return; }
        const days = Math.floor(diff / (1000*60*60*24));
        const hours = Math.floor((diff/(1000*60*60))%24);
        const minutes = Math.floor((diff/(1000*60))%60);
        const seconds = Math.floor((diff/1000)%60);
        container.textContent = `${days} å¤© ${hours} æ™‚ ${minutes} åˆ† ${seconds} ç§’`;
      }

      tick();
      const timer = setInterval(tick, 1000);
      return container;
    }

    // -----------------------------
    // Views
    // -----------------------------
    function renderHome() {
      const nextRace = state.races[0];
      const html = document.createElement('div');
      html.innerHTML = `
        <h2 class="text-3xl font-bold mb-4">ä¸‹ä¸€å ´æ¯”è³½å€’æ•¸</h2>
        <div class="bg-white rounded-2xl p-6 shadow mb-6">
          <div id="nextRaceName" class="text-xl mb-2"></div>
          <div id="nextRaceCountdown"></div>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <div class="bg-white rounded-2xl p-6 shadow">
            <h3 class="text-2xl font-semibold mb-2">è³½ç¨‹å¿«é€Ÿé€£çµ</h3>
            <a href="#/races" class="text-blue-500 underline">æŸ¥çœ‹å…¨éƒ¨è³½ç¨‹ â†’</a>
          </div>

          <div class="bg-white rounded-2xl p-6 shadow">
            <h3 class="text-2xl font-semibold mb-2">è»Šæ‰‹å¿«é€Ÿé€£çµ</h3>
            <a href="#/drivers" class="text-blue-500 underline">æŸ¥çœ‹è»Šæ‰‹ â†’</a>
          </div>
        </div>
      `;

      const view = document.getElementById('view'); view.innerHTML=''; view.appendChild(html);

      if (nextRace) {
        document.getElementById('nextRaceName').textContent = `${nextRace.raceName} Â· ${nextRace.Circuit?.circuitName || ''}`;
        const iso = nextRace.date + (nextRace.time ? nextRace.time : '');
        const countdownEl = Countdown(iso);
        document.getElementById('nextRaceCountdown').appendChild(countdownEl);
      } else {
        document.getElementById('nextRaceName').textContent = 'å°šç„¡è³½ç¨‹è³‡æ–™';
      }
    }

    function renderRaces() {
      const view = document.getElementById('view'); view.innerHTML = '';
      const container = document.createElement('div');
      container.innerHTML = `<h2 class="text-3xl font-bold mb-4">è³½ç¨‹ï¼ˆ${state.season === 'current' ? new Date().getFullYear() : state.season}ï¼‰</h2>`;

      if (state.races.length === 0) {
        container.innerHTML += '<div class="p-4 bg-white rounded">å°šç„¡è³½ç¨‹è³‡æ–™</div>';
      } else {
        const grid = document.createElement('div'); grid.className = 'grid gap-4';
        state.races.forEach(r => {
          const card = document.createElement('div'); card.className = 'bg-white p-4 rounded shadow';
          card.innerHTML = `
            <div class="font-medium">${r.raceName}</div>
            <div class="text-sm text-gray-500">${r.Circuit?.circuitName || ''} Â· ${r.Circuit?.Location?.locality || ''}, ${r.Circuit?.Location?.country || ''}</div>
            <div class="text-xs mt-2">${formatDateISO(r.date + (r.time||''))}</div>
          `;
          grid.appendChild(card);
        });
        container.appendChild(grid);
      }

      view.appendChild(container);
    }

    function renderDrivers() {
      const view = document.getElementById('view'); view.innerHTML = '';
      const container = document.createElement('div');
      container.innerHTML = `<h2 class="text-3xl font-bold mb-4">è»Šæ‰‹åˆ—è¡¨</h2>`;

      if (state.drivers.length === 0) {
        container.innerHTML += '<div class="p-4 bg-white rounded">å°šç„¡è»Šæ‰‹è³‡æ–™</div>';
      } else {
        const grid = document.createElement('div'); grid.className = 'grid md:grid-cols-2 gap-4';
        state.drivers.forEach(d => {
          const card = document.createElement('div'); card.className = 'bg-white p-4 rounded shadow';
          card.innerHTML = `
            <div class="font-medium">${d.name}</div>
            <div class="text-sm text-gray-500">${d.team}</div>
          `;
          grid.appendChild(card);
        });
        container.appendChild(grid);
      }

      view.appendChild(container);
    }

    // -----------------------------
    // Theme toggle
    // -----------------------------
    const themeBtn = document.getElementById('themeToggle');
    themeBtn.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      if (isDark) {
        document.body.classList.add('bg-black','text-white');
        themeBtn.textContent = 'æ·ºè‰²';
      } else {
        document.body.classList.remove('bg-black','text-white');
        themeBtn.textContent = 'æ·±è‰²';
      }
    });
  </script>
</body>
</html>
